ğŸŒ Language: [EN](/node-red-contrib-knx-ultimate/wiki/IoT-Bridge-Configuration) | [IT](/node-red-contrib-knx-ultimate/wiki/it-IoT-Bridge-Configuration) | [DE](/node-red-contrib-knx-ultimate/wiki/de-IoT-Bridge-Configuration) | [FR](/node-red-contrib-knx-ultimate/wiki/fr-IoT-Bridge-Configuration) | [ES](/node-red-contrib-knx-ultimate/wiki/es-IoT-Bridge-Configuration) | [ç®€ä½“ä¸­æ–‡](/node-red-contrib-knx-ultimate/wiki/zh-CN-IoT-Bridge-Configuration)

<!-- NAV START -->
å¯¼èˆª: [é¦–é¡µ](/node-red-contrib-knx-ultimate/wiki/zh-CN-Home)  
æ¦‚è§ˆ: [Changelog](https://github.com/Supergiovane/node-red-contrib-knx-ultimate/blob/master/CHANGELOG.md) â€¢ [å¸¸è§é—®é¢˜](/node-red-contrib-knx-ultimate/wiki/zh-CN-FAQ-Troubleshoot) â€¢ [å®‰å…¨](/node-red-contrib-knx-ultimate/wiki/zh-CN-SECURITY) â€¢ [æ–‡æ¡£ï¼šè¯­è¨€æ ](/node-red-contrib-knx-ultimate/wiki/zh-CN-Docs-Language-Bar)  
KNX è®¾å¤‡: [ç½‘å…³](/node-red-contrib-knx-ultimate/wiki/zh-CN-Gateway-configuration) â€¢ [è®¾å¤‡](/node-red-contrib-knx-ultimate/wiki/zh-CN-Device) â€¢ [èŠ‚ç‚¹ä¿æŠ¤](/node-red-contrib-knx-ultimate/wiki/zh-CN-Protections)  
å…¶ä»– KNX èŠ‚ç‚¹: [åœºæ™¯æ§åˆ¶å™¨](/node-red-contrib-knx-ultimate/wiki/zh-CN-SceneController-Configuration) â€¢ [çœ‹é—¨ç‹—](/node-red-contrib-knx-ultimate/wiki/zh-CN-WatchDog-Configuration) â€¢ [æ—¥å¿—èŠ‚ç‚¹](/node-red-contrib-knx-ultimate/wiki/zh-CN-Logger-Configuration) â€¢ [å…¨å±€ä¸Šä¸‹æ–‡](/node-red-contrib-knx-ultimate/wiki/zh-CN-GlobalVariable) â€¢ [å‘Šè­¦å™¨](/node-red-contrib-knx-ultimate/wiki/zh-CN-Alerter-Configuration) â€¢ [è´Ÿè½½æ§åˆ¶](/node-red-contrib-knx-ultimate/wiki/zh-CN-LoadControl-Configuration) â€¢ [æŸ¥çœ‹å™¨](/node-red-contrib-knx-ultimate/wiki/zh-CN-knxUltimateViewer) â€¢ [è‡ªåŠ¨å“åº”](/node-red-contrib-knx-ultimate/wiki/zh-CN-KNXAutoResponder) â€¢ [HA ç¿»è¯‘å™¨](/node-red-contrib-knx-ultimate/wiki/zh-CN-HATranslator) â€¢ [ç‰©è”ç½‘æ¡¥æ¥](/node-red-contrib-knx-ultimate/wiki/zh-CN-IoT-Bridge-Configuration)  
HUE: [Bridge](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Bridge+configuration) â€¢ [ç¯](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Light) â€¢ [ç”µæ± ](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Battery) â€¢ [æŒ‰é’®](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Button) â€¢ [æ¥è§¦](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Contact+sensor) â€¢ [è®¾å¤‡è½¯ä»¶æ›´æ–°](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Device+software+update) â€¢ [å…‰ç…§ä¼ æ„Ÿå™¨](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Light+sensor) â€¢ [è¿åŠ¨](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Motion) â€¢ [åœºæ™¯](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Scene) â€¢ [Tap Dial](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Tapdial) â€¢ [æ¸©åº¦](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Temperature+sensor) â€¢ [Zigbee è¿æ¥](/node-red-contrib-knx-ultimate/wiki/zh-CN-HUE+Zigbee+connectivity)  
ç¤ºä¾‹: [æ—¥å¿—](/node-red-contrib-knx-ultimate/wiki/zh-CN-Logger-Sample) â€¢ [Switch Light](/node-red-contrib-knx-ultimate/wiki/-Sample---Switch-light) â€¢ [Dimming](/node-red-contrib-knx-ultimate/wiki/-Sample---Dimming) â€¢ [RGB color](/node-red-contrib-knx-ultimate/wiki/-Sample---RGB-Color) â€¢ [RGBW color + White](/node-red-contrib-knx-ultimate/wiki/-Sample---RGBW-Color-plus-White) â€¢ [Command a scene actuator](/node-red-contrib-knx-ultimate/wiki/-Sample---Control-a-scene-actuator) â€¢ [Datapoint 213.x 4x Setpoint](/node-red-contrib-knx-ultimate/wiki/-Sample---DPT213) â€¢ [Datapoint 222.x 3x Setpoint](/node-red-contrib-knx-ultimate/wiki/-Sample---DPT222) â€¢ [Datapoint 237.x DALI diags](/node-red-contrib-knx-ultimate/wiki/-Sample---DPT237) â€¢ [Datapoint 2.x 1 bit proprity](/node-red-contrib-knx-ultimate/wiki/-Sample---DPT2) â€¢ [Datapoint 22.x RCHH Status](/node-red-contrib-knx-ultimate/wiki/-Sample---DPT22) â€¢ [Datetime to BUS](/node-red-contrib-knx-ultimate/wiki/-Sample---DateTime-to-BUS) â€¢ [Read Status](/node-red-contrib-knx-ultimate/wiki/-Sample---Read-value-from-Device) â€¢ [Virtual Device](/node-red-contrib-knx-ultimate/wiki/-Sample---Virtual-Device) â€¢ [Subtype decoded](/node-red-contrib-knx-ultimate/wiki/-Sample---Subtype) â€¢ [Alexa](/node-red-contrib-knx-ultimate/wiki/-Sample---Alexa) â€¢ [Apple Homekit](/node-red-contrib-knx-ultimate/wiki/-Sample---Apple-Homekit) â€¢ [Google Home](/node-red-contrib-knx-ultimate/wiki/-Sample---Google-Assistant) â€¢ [Switch on/off POE port of Unifi switch](/node-red-contrib-knx-ultimate/wiki/-Sample---UnifiPOE) â€¢ [Set configuration by msg](/node-red-contrib-knx-ultimate/wiki/-Sample-setConfig) â€¢ [Scene Controller node](/node-red-contrib-knx-ultimate/wiki/Sample-Scene-Node) â€¢ [WatchDog node](/node-red-contrib-knx-ultimate/wiki/-Sample---WatchDog) â€¢ [Global Context node](/node-red-contrib-knx-ultimate/wiki/SampleGlobalContextNode) â€¢ [Alerter node](/node-red-contrib-knx-ultimate/wiki/SampleAlerter) â€¢ [Load control node](/node-red-contrib-knx-ultimate/wiki/SampleLoadControl) â€¢ [Viewer node](/node-red-contrib-knx-ultimate/wiki/knxUltimateViewer) â€¢ [MySQL, InfluxDB, MQTT Sample](/node-red-contrib-knx-ultimate/wiki/Sample-KNX2MQTT-KNX2MySQL-KNX2InfluxDB)  
Contribute to Wiki: [Link](/node-red-contrib-knx-ultimate/wiki/zh-CN-Manage-Wiki)
<!-- NAV END -->

---

# KNX â†” IoT Bridge

Bridge èŠ‚ç‚¹å°† KNX ç”µæŠ¥æ ‡å‡†åŒ–ä¸ºé€‚ç”¨äº IoT ä¼ è¾“ï¼ˆMQTTã€RESTã€Modbusï¼‰çš„ç»“æ„åŒ–æ¶ˆæ¯ï¼Œå¹¶å…è®¸é€šè¿‡ Flow è¾“å…¥å†™å› KNX æ€»çº¿ã€‚æœ¬æ–‡æ¦‚è¿°é…ç½®è¦ç‚¹ä»¥åŠæ¨èçš„ç¬¬ä¸‰æ–¹èŠ‚ç‚¹ã€‚

## å­—æ®µé€Ÿè§ˆ

| å­—æ®µ | ä½œç”¨ | å¤‡æ³¨ |
| -- | -- | -- |
| **Label** | æ˜¾ç¤ºåç§° | å±•ç¤ºåœ¨çŠ¶æ€æ å’Œ `msg.bridge.label` ä¸­ã€‚ |
| **GA / DPT** | ç»„åœ°å€ä¸æ•°æ®ç‚¹ | å¯æ‰‹åŠ¨å¡«å†™æˆ–ä½¿ç”¨ ETS è‡ªåŠ¨è¡¥å…¨ã€‚ |
| **Direction** | KNXâ†’IoT / IoTâ†’KNX / åŒå‘ | å†³å®šå¯ç”¨çš„è¾“å‡ºã€‚ |
| **Channel type** | MQTT / REST / Modbus | æ”¹å˜ `Target` çš„æ„ä¹‰ã€‚ |
| **Target** | ä¸»é¢˜ã€åŸºç¡€ URL æˆ–å¯„å­˜å™¨ | ç•™ç©ºæ—¶ä½¿ç”¨èŠ‚ç‚¹çš„ `outputtopic`ã€‚ |
| **Template** | å­—ç¬¦ä¸²æ¨¡æ¿ | æ”¯æŒ `{{value}}`, `{{ga}}`, `{{type}}`, `{{target}}`, `{{label}}`, `{{isoTimestamp}}`ã€‚ |
| **Scale / Offset** | æ•°å€¼è½¬æ¢ | ç”¨äº KNXâ†’IoTï¼›IoTâ†’KNX ä½¿ç”¨é€†å˜æ¢ã€‚ |
| **Timeout / Retry** | é‡è¯•æç¤º | ä¸‹æ¸¸èŠ‚ç‚¹å¯æ®æ­¤æ§åˆ¶é‡æ–°å‘é€ã€‚ |

## å¸¸è§ä¼ è¾“

### MQTT Broker

- **å‘å¸ƒ**ï¼šå°†è¾“å‡º 1 æ¥åˆ°æ ¸å¿ƒèŠ‚ç‚¹ `mqtt out`ï¼Œæ¡¥æ¥å·²å¡«å……ä¸»é¢˜å’Œè½½è·ã€‚
- **è®¢é˜…**ï¼šå°† `mqtt in` è¿æ¥åˆ°æ¡¥æ¥è¾“å…¥ä»¥æŠŠ MQTT æ¶ˆæ¯å†™å…¥ KNXï¼Œç¬¬ 2 è¾“å‡ºæä¾›ç¡®è®¤ã€‚

### REST API

- æŠŠè¾“å‡º 1 æ¥å…¥æ ¸å¿ƒ `http request`ï¼ˆæˆ–å¦‚ [`node-red-contrib-http-request`](https://flows.nodered.org/node/node-red-contrib-http-request) çš„è´¡çŒ®èŠ‚ç‚¹ï¼‰ã€‚
- æ¡¥æ¥èŠ‚ç‚¹ä¼šæŠŠ `bridge.method` å¤åˆ¶åˆ° `msg.method` å¹¶å°†æ¨¡æ¿ç»“æœæ”¾å…¥ payloadï¼Œé€‚åˆå‘ Webhook æ¨é€ JSONã€‚

### Modbus å¯„å­˜å™¨

- æ­é… [`node-red-contrib-modbus`](https://flows.nodered.org/node/node-red-contrib-modbus) ä½¿ç”¨ï¼ˆ`modbus-flex-write` ç­‰ï¼‰ã€‚
- `Target` è¡¨ç¤ºå¯„å­˜å™¨ï¼›`msg.payload` å¸¦æœ‰è½¬æ¢åçš„å€¼ã€‚

## Flow ç¤ºä¾‹

### KNX çŠ¶æ€ â†’ MQTT

```json
[
  {
    "id": "bridge1",
    "type": "knxUltimateIoTBridge",
    "z": "flow1",
    "server": "gateway1",
    "name": "ç¯å…‰æ¡¥æ¥",
    "emitOnChangeOnly": true,
    "readOnDeploy": true,
    "acceptFlowInput": true,
    "mappings": [
      {
        "id": "map-light",
        "enabled": true,
        "label": "å®¢å…ç¯",
        "ga": "1/1/10",
        "dpt": "1.001",
        "direction": "bidirectional",
        "iotType": "mqtt",
        "target": "knx/light/living",
        "method": "POST",
        "modbusFunction": "writeHoldingRegister",
        "scale": 1,
        "offset": 0,
        "template": "{{value}}",
        "property": "",
        "timeout": 0,
        "retry": 0
      }
    ],
    "wires": [["mqttOut"],["debugAck"]]
  },
  {
    "id": "mqttOut",
    "type": "mqtt out",
    "name": "MQTT çŠ¶æ€",
    "topic": "",
    "qos": "0",
    "retain": "false",
    "broker": "mqttBroker",
    "x": 520,
    "y": 120,
    "wires": []
  },
  {
    "id": "debugAck",
    "type": "debug",
    "name": "KNX å›æ‰§",
    "active": true,
    "tosidebar": true,
    "complete": "true",
    "x": 520,
    "y": 180,
    "wires": []
  }
]
```

### MQTT æŒ‡ä»¤ â†’ KNX

```json
[
  {
    "id": "mqttIn",
    "type": "mqtt in",
    "name": "MQTT æŒ‡ä»¤",
    "topic": "knx/light/living/set",
    "qos": "1",
    "datatype": "auto",
    "broker": "mqttBroker",
    "x": 140,
    "y": 200,
    "wires": [["bridge1"]]
  }
]
```

ç»„åˆä¸Šè¿°ç‰‡æ®µå³å¯å®ç° KNX â†” MQTT å¾ªç¯å¹¶è·å¾—ç¡®è®¤ã€‚

### REST å¿«ç…§

```json
{
  "id": "bridge-rest",
  "type": "knxUltimateIoTBridge",
  "name": "åŠŸç‡æ¡¥æ¥",
  "mappings": [
    {
      "label": "æ€»æœ‰åŠŸåŠŸç‡",
      "ga": "2/1/20",
      "dpt": "9.024",
      "direction": "knx-to-iot",
      "iotType": "rest",
      "target": "https://example/api/knx/power",
      "method": "POST",
      "template": "{\"value\":{{value}},\"ga\":\"{{ga}}\",\"ts\":\"{{isoTimestamp}}\"}"
    }
  ]
}
```

å°†è¾“å‡º 1 å¼•å…¥ `http request` å¹¶ç»“åˆ `bridge.retry` å¤„ç†é‡è¯•ç­–ç•¥ã€‚

### Modbus å†™å…¥

1. è®¾ç½® `Target = 40010`ã€`Channel type = Modbus`ã€`Direction = Bidirectional`ã€‚
2. å°†è¾“å‡º 1 è¿æ¥åˆ° `modbus-flex-write`ï¼ŒæŠŠ `msg.payload` æä¾›ç»™å…¶å€¼è¾“å…¥ã€‚
3. é€šè¿‡ç¬¬ 2 è¾“å‡ºç¡®è®¤ KNX æ˜¯å¦å·²åœ¨å¯„å­˜å™¨æ›´æ–°ååŒæ­¥ã€‚

## æç¤º

- `Target` ç•™ç©ºæ—¶ï¼Œå¤šä¸ªæ˜ å°„å¯å…±äº« `outputtopic`ã€‚
- `emitOnChangeOnly` å¯é™ä½é«˜é¢‘ä¼ æ„Ÿå™¨å™ªå£°ï¼›å¦‚éœ€å…¨éƒ¨ç”µæŠ¥ï¼Œå¯å…³é—­ã€‚
- ç¬¬ 2 è¾“å‡ºå§‹ç»ˆå¸¦æœ‰ IoT åŸå§‹ payload å’Œ `bridge` å…ƒæ•°æ®ï¼Œä¾¿äºè°ƒè¯•ç¼©æ”¾ã€‚
- è‹¥è®¾å¤‡éœ€è¦ç‰¹å®š Modbus æµ®ç‚¹æ ¼å¼ï¼Œå¯æ’å…¥ `function` èŠ‚ç‚¹ç”Ÿæˆæ‰€éœ€å­—èŠ‚åºã€‚

ç¥ä½ æ¡¥æ¥é¡ºåˆ©ï¼

