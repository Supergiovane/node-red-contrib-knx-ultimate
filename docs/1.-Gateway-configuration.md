
To be able to interact with the KNX bus, you need to configure the Node's gateway. It stores the default ETH/KNX Router's multicast address as well as the default port. It should work with the default values.

* **Name**
> Node name.

* **Simple KNX connection**
> The node connects to a network KNX Gateway in unsecured mode (this is the simplest and easiest connection to configure, but it does not offer encryption of IP telegrams from the Node-Red node to the KNX / IP Gateway). <br/>
> * **IP/Hostname**: ETH/KNX Router multicast address or Interface unicast IP address. **Yes but what must i put in there?** If you have an KNX/IP interface, use the interface's IP address, for example 1982.168.1.22, otherwise, if you have a KNX/IP router, put the multicast address 224.0.23.12. You can also type an Hostname instead of an IP.<br/> Type 
> * **Port**: ETH/KNX Router/Interface port.<br/>

* **Secure KNX connection (AVAIABLE FROM DECEMBER 2023**
> The node connects to a KNX Gateway network in secure and encrypted mode. It is necessary to export the "keyring" file from ETS, which contains all the details for the encrypted connection and import it into the *Keyring file* field. Here you can see how to export the Keyring file from ETS: https://youtu.be/OpR7ZQTlMRU <br/>
> * **Keyring file**: Paste here the XML of the Keyring file exported from ETS. Here you can see how to export the Keyring file from ETS: https://youtu.be/OpR7ZQTlMRU . The KNX-Ultimate will use the hashes of the encrypted keys of this file, in order to communicate using the KNX Secure protocol.<br/>
> * **Password**: Enter the password you used when exporting the ETS Keyring file.<br/>
> * **Login**: Press this button to decrypt the Keyring file and verify that the password is correct. <br/>

* **Bind to local interface**
> The Node will use this local interface for communications. Leave "Auto" for automatic selection. If you have more than one lan connection, for example Ethernet and Wifi, it's strongly recommended to manually select the interface, otherwise not all UDP telegram will reach your computer, thus the Node may not work as expected.

* **Automatically connect to KNX BUS at start**
> Select wether to automatically connect to the KNX BUS at start, or not. Default is Yes. If you select "No", you must manually connect to the KNX BUS, by sending ***msg.connectGateway = true*** to a Wachdog node. Please seee the Wiki (Watchdog node) for further instruction on how to manually connect/disconnect and change the configuration on the fly.

## ADVANCED OPTIONS

* **KNX Physical Address**
> Local KNX physical addres, identifying the KNX device. Default "15.15.22". This is not a group address, this represents the unique address of a konnex device in a konnex installation.

* **Echo sent message to all node with same Group Address**
> When the your gateway is an **KNX/IP Interface** (not a KNX/IP Router) or a **knxd in unicast mode** and if you have more than one node on your flows, having the same *group address*, whenever you send a MSG to the node, the other nodes with same *group address* doesn't react to this sent message. Setting this option to *true* (default), the other nodes receive the telegram that has been sent. If you're using an KNX/IP Router as a gateway instead, this behaviour is already built into the gateway and **this option will be ignored**.

* **Show last update day and time in status**
> Display last update day and time, in the format (day, hh:mm:ss);

* **Show device name in status (require "Listen all Group Address" is checked)**
> Display device name in node status. This option is only taken in consideration if "Listen all Group Address" is checked. Displays the KNX device name.

* **Show datapoint in status**
> Display the node's KNX Datapoint. 

* **Suppress repeated (R-Flag) telegrams fom BUS**
> When enabled, this option suppress the telegrams marked as "repeated" (with R-Flag) coming from the bus. The gateway will not react to telegrams coming from KNX bus, marked as "Repeated". Whenever a KNX device sends a telegram to the bus to a specific group address, it waits for an acknowledge signal, confirming that the telegram has arrived. If it doesn't receive this acknowledgemet, it sends the same telegrams again (for a maximum of 3 times). This can lead to multiple msg to be output by the KNX-Ultimate nodes. You can avoid this by setting the RBE filter on standard KNX-Ultimate nodes, but for KNX-Ultimate nodes set as "Universal", RBE filter is not avaiable, so you must enable this option.  https://support.knx.org/hc/en-us/articles/115003805665-Multiple-LL-acknowledgements

* **Suppress ACK request**
> This option help compatibility with old Siemens SWG1 148-1AB22 IP Interface firmware and other EHT/KNX interfaces that does'nt like the ACK. Default "unchecked". Check it to help compatibility

* **Delay between each telegram (in milliseconds)**
> This option allows you to specify a delay between each telegram sent to the KNX BUS. Increase the delay if your KNX/IP Interface/Router has trouble receiving ethernet telegrams, or in the ETS debugger, some telegrams are missing. The default is 50. The other option **and further multiply delay only between -read- telegrams** it's useful if you want to further increase the delay **only** between *read* telegrams, having lower proirity. For example, if you set the delay to ***50ms***, and set this value to ***10x***, you'll have a delay of 500ms between *read* telegrams. The delay between other *write* and *response* telegrams, remains 50ms.

* **Loglevel**
> Define the log level of the underling KNX library. Useful for debugging in case of problem. Normally, you don't need to change this. Normally, it's set to "Info"

* **List of your nodes in all flows**
> This is a list of all the knx-ultimate nodes, you inserted into your flows. This is useful, for example, to copy each group address and to paste it into a KNX Router filter table, for example. Or you can just check, if you wrongly added two knx-ultimate node with same Group Address but with different Datapoint.


<br />
<br />
<img src='https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/wiki/etslogo.png'>


### WORKING WITH THE ETS CSV OR ESF FILE
Instead of create a knx-ultimate node for each Group Address to control, you can import your ETS csv group addresses file or, starting from V 1.1.35, an ESF file as well (If, for example,  you only have ETS Inside). Supported ETS versions: ETS 4 and onwards.<br/>
Starting from version 1.4.18, you can also simply enter the path to the file in this field (e.g.: /home/pi/mycsv.csv).<br/>
Thanks to that, the knx-ultimate node where you selected **Universal mode (listen to all Group Addresses)**, becomes an universal input/output node, aware of all Datapoints, Group Addresses and Device's name (ex: Living Room Lamp). Just send the payload to the knx-ultimate node, and it'll encode it with the right datapoint and send it to the bus. Likewise, when the knx-ultimate node receives a telegram from the bus, it outputs a right decoded payload using the datapoint specified in the ETS CSV or ESF file.
Starting from **Version 1.1.11**, you can use **Universal mode (listen to all Group Addresses)** option without the need of an imported ETS CSV or ESF File. You need to pass a message to the node, containing datapoint type and a value. As soon as the node receives a telegram from KNX Bus, it will output a RAW value and beside that, it will try to decode the value without knowing the datapoint type.<br />
**Note**: *ETS CSV Group address exported file* is way the best option, because it contain a precise datapoints with subtype. *ETS ESF exported file* is simpler and it doesn't have the subtype.<br />
If you can use both, please prefer the **ETS CSV Group address exported file**, because the ESF can lead to a false output values. Please manually check and eventually adjust the datapoints each time you import the **ESF** file.<br />From version 1.4.1 you can import group addresses also at runtime, via msg, using the WatchDog node. <br />

> You can work with a mix of knx-ultimate nodes, some with **Universal mode (listen to all Group Addresses)** checked and some not. You are absolutely free!


<a href="https://youtu.be/egRbR_KwP9I"><img src='https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/yt.png'></a>



* **ETS CSV Group Addresses List import**

  ***ATTENTION: THERE MUST NOT BE TABULATION CHARACTERS IN THE NAME OF THE GROUP ADDRESS***

**If Group Address has no Datapoint**
> If a Group address has no Datapoint set in the ETS, you can select to stop and abort the entire import process, to skip the affected group address, or to add the the affected Group Address with a fake datapoint and continue import.<br/>

**How to export the ETS -> CSV <- Group Addresses List**
> On ETS, click the group addresses list, then right click, then select 'export group addresses'. On the export window, select these options: <br />
> **Output Format**: CSV <br />
> **CSV Format**: 1/1 Name/Address <br />
> **Export with header line**: checked <br />
> **CSV Separator**: Tabulator.  <br />
> Then paste the file content here. <br />
> Note that the ETS CSV FILE must contain the Datapoints for each Group Address.  <br />
> The node parses your ETS CSV FILE prior to use it and will tell you the results in the DEBUG TAB of Node-Red page. <br />
> The result can be of two types: **ERROR** and **WARNING** <br />
> **ERROR** occurs when a Datapoint is not specified for a Group Address. This is a critical error and stops the process of importing the ETS CSV FILE. <br />
> **WARNING** occurs when a Datapoint's subtype is not specified. In this case the node parser will append a default one, but warns you that you shoult watch and correct the Datapoint, by adding a subtype. A Subtype is the number staying at the right of the "." in a Datapoint (ex: 5.001).<br />
> Note: the fields must be surrounded by **"** For example:<br />
>>"Group name"	"Address"	"Central"	"Unfiltered"	"Description"	"DatapointType"	"Security"<br />
>>"Attuatori luci"	"0/-/-"	""	""	""	""	"Auto"<br />

**How to export the ETS -> ESF <- Group Addresses List**
> On ETS window, select your project, then click the export icon (the icon with the up arrow)<br />
> Select to export the project in ESF format (not the default .knxprod)<br />
> Then copy the file content and paste it into the gateway config "ETS group address list" field.


<p>
    <table style="font-size:12px">
        <tr>
        <th colspan="2" style="font-size:14px">Node status colors explanation</th>
        </tr>
        <tr>
        <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greendot.png"></img></td>
        <td>React to write telegrams</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greenring.png"></img></td>
            <td>Circular reference protection. <a href="https://github.com/Supergiovane/node-red-contrib-knx-ultimate/wiki" target="_blank">See this page.</a></td>
        </tr>
        <tr>
        <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/bluedot.png"></img></td>
        <td>React to response telegrams.</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/bluering.png"></img></td>
            <td>Auto send node value as response to the BUS. <a href="https://github.com/Supergiovane/node-red-contrib-knx-ultimate/wiki/-Sample---Virtual-Device" target="_blank">See Virtual Device.</a></td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greudot.png"></img></td>
            <td>React to read telegrams.</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greyring.png"></img></td>
            <td>RBE filter: no telegrams has been sent.</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/reddot.png"></img></td>
            <td>Error or disconnected.</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/redring.png"></img></td>
            <td>Node DISABLED due to a circulare reference. <a href="https://github.com/Supergiovane/node-red-contrib-knx-ultimate/wiki" target="_blank">See this page.</a></td>
        </tr>
    </table>
</p>
