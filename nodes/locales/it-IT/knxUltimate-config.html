<script type="text/markdown" data-help-name="knxUltimate-config">
# Configurazione del KNX Gateway

Questo nodo si connette al tuo KNX/IP Gateway.

**Generale**
|Proprietà|Descrizione|
|--|--|
| Nome | Nome del nodo. |
| IP/Hostname | Indirizzo multicast dell’ETH/KNX Router o indirizzo IP unicast dell’interfaccia. Con una KNX/IP Interface usa l’IP dell’interfaccia (es. 192.168.1.22). Con un KNX/IP Router usa l’indirizzo multicast `224.0.23.12`. Puoi inserire anche un **Hostname**. |

<br/>

**Configurazione**
|Proprietà|Descrizione|
|--|--|
| IP Port | Porta di connessione. Default: `3671`. |
| IP Protocol | `Tunnel UDP` per interfacce KNX/IP, `Multicast UDP` per router KNX/IP. Lascia **Auto** per l’autorilevamento (default). |
| KNX Physical Address | Indirizzo fisico KNX, es. `1.1.200`. Default: `15.15.22`. |
| Bind to local interface | Interfaccia di rete locale usata dal nodo. Lascia "Auto" per selezione automatica. Se hai più interfacce (Ethernet/Wi‑Fi), è consigliato impostarla manualmente per evitare perdita di telegrammi UDP. Default: "Auto". |
| Automatically connect to KNX BUS at start | Connessione automatica al BUS all’avvio. Default: "Yes". |
| Secure credentials source | Scegli **File keyring ETS** (default) per fornire il contenuto `.knxkeys` e la password, oppure **Credenziali manuali** per usare indirizzo individuale e password del tunnel senza keyring. Il cambio modalità mostra solo i campi pertinenti. |
| Tunnel interface individual address | Visibile solo con **Credenziali manuali**. Indirizzo individuale dell’interfaccia tunnel sicura (es. `1.1.1`). Lascia vuoto per negoziazione automatica da parte di KNX Ultimate. |
| Tunnel user password | Visibile solo con **Credenziali manuali**. Password dell’utente di tunnelling sicuro configurato in ETS. |

<br/>

**Avanzate**
|Proprietà|Descrizione|
|--|--|
| Echo sent message to all node with same Group Address | Inoltra ai nodi con lo stesso GA i msg inviati dal flow, come se provenissero dal BUS. Utile in emulazione KNX o senza connessione al BUS. **Opzione in deprecazione e presto abilitata di default.** Default: abilitato. |
| Suppress repeated (R-Flag) telegrams fom BUS | Ignora i telegrammi ripetuti (flag R) dal BUS. Default: disabilitato. |
| Suppress ACK request in tunneling mode | Per vecchie interfacce KNX/IP: ignora l’ACK e accetta tutti i telegrammi. Default: disabilitato. |
| Delay between each telegram (ms) | Lo standard KNX prevede max 50 telegrammi/s. Un intervallo 25–50ms è adeguato. Con gateway remoto su link lento aumenta (es. 200–500ms). |
| Loglevel | Livello di log per il debug. Default: "Error". |

<br/>

**Import file ETS**
|Proprietà|Descrizione|
|--|--|
| If Group Address has no Datapoint | Se un GA non ha datapoint: interrompi import, salta il GA o aggiungi un datapoint fittizio `1.001` e continua. |
| ETS group address list | Incolla qui il contenuto del file ETS (CSV o ESF) oppure indica un percorso file (es. `/home/pi/mycsv.csv`). Consulta i link di help per i dettagli. |

<br/>

**Utility**
|Proprietà|Descrizione|
|--|--|
| Gather debug info for troubleshoot | Clicca il pulsante e allega l’output alla issue su GitHub: aiuta molto l’analisi. |
| Get all used GA for KNX routing filter | Clicca READ per ottenere l’elenco di tutti i GA usati nei flow associati a questo gateway, utile per popolare la tabella filtri del tuo KNX/IP Router. |

<br/>

# Lavorare con i file ETS CSV o ESF

Invece di creare un nodo per ogni GA da controllare, puoi importare il file ETS di indirizzi di gruppo in formato CSV (consigliato) o ESF (da v1.1.35, utile con ETS Inside). ETS supportata: v4+.

Da v1.4.18 puoi anche indicare direttamente il percorso al file nel campo (es.: `/home/pi/mycsv.csv`).

Con **Universal mode (listen to all Group Addresses)** il nodo diventa I/O universale, consapevole di Datapoint, GA e nomi dispositivi. Invia un `payload` al nodo e lui codifica col DPT corretto; viceversa, decodifica i telegrammi in arrivo usando il DPT dell’ETS.

Da v1.1.11 puoi usare la modalità universale anche senza file ETS: invia al nodo un messaggio con tipo DPT e valore. Alla ricezione da BUS, il nodo emette anche il RAW e prova a decodificare senza DPT.

Nota: il file CSV contiene DPT precisi con sottotipo; l’ESF è più semplice e non include il sottotipo. Se puoi, preferisci il CSV: l’ESF può generare valori errati; controlla e correggi eventuali DPT dopo l’import. Da v1.4.1 è possibile importare anche a runtime via msg (nodo WatchDog).

Video: <a href="https://youtu.be/egRbR_KwP9I"><img src='https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/yt.png'></a>

- **Import ETS CSV Group Addresses**

  ATTENZIONE: nel nome del GA non devono esserci caratteri di tabulazione.

**If Group Address has no Datapoint**

> Se in ETS un GA non ha DPT, puoi: interrompere l’import, saltare il GA, oppure aggiungere il GA con DPT fittizio e continuare.

**Come esportare l’elenco GA in formato CSV da ETS**

> In ETS seleziona l’elenco GA, click destro → Esporta indirizzi di gruppo. Nella finestra di export imposta:<br/>
> Output Format: CSV<br/>
> CSV Format: 1/1 Name/Address<br/>
> Export with header line: spuntato<br/>
> CSV Separator: Tabulator<br/>
> Poi incolla qui il contenuto del file.<br/>
> Il file deve contenere i Datapoint per ogni GA. Il nodo analizza il file e mostra risultati nel DEBUG di Node‑RED.

> Esiti possibili: **ERROR** (manca DPT → import interrotto) e **WARNING** (manca sottotipo → aggiunto default, ma va verificato). Il sottotipo è il numero dopo il punto, es. `5.001`.

> I campi devono essere racchiusi tra virgolette `"`.

**Come esportare l’elenco GA in formato ESF da ETS**

> In ETS seleziona il progetto, icona export (freccia in su), scegli formato ESF (non `.knxprod`). Copia e incolla nel campo "ETS group address list" del gateway.

<p>
    <table style="font-size:12px">
        <tr><th colspan="2" style="font-size:14px">Significato colori stato nodo</th></tr>
        <tr><td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greendot.png"></td><td>Reagisci a telegrammi di scrittura</td></tr>
        <tr><td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greenring.png"></td><td>Protezione da riferimenti circolari (<a href="https://github.com/Supergiovane/node-red-contrib-knx-ultimate/wiki" target="_blank">vedi pagina</a>)</td></tr>
        <tr><td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/bluedot.png"></td><td>Reagisci a telegrammi di risposta</td></tr>
        <tr><td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/bluering.png"></td><td>Invio automatico del valore del nodo come risposta al BUS (<a href="https://github.com/Supergiovane/node-red-contrib-knx-ultimate/wiki/-Sample---Virtual-Device" target="_blank">Virtual Device</a>)</td></tr>
        <tr><td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greudot.png"></td><td>Reagisci a telegrammi di lettura</td></tr>
        <tr><td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greyring.png"></td><td>Filtro RBE: nessun telegramma è stato inviato</td></tr>
        <tr><td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/reddot.png"></td><td>Errore o disconnesso</td></tr>
        <tr><td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/redring.png"></td><td>Nodo DISABILITATO per riferimento circolare (<a href="https://github.com/Supergiovane/node-red-contrib-knx-ultimate/wiki" target="_blank">vedi pagina</a>)</td></tr>
    </table>
</p>
</script>
