<script type="text/markdown" data-help-name="knxUltimate-config">
# KNX Gateway Configuration

<p>This node connects to your KNX/IP Gateway.</p>

**General**
|Property|Description|
|--|--|
| Name | Node name. |
| IP/Hostname | ETH/KNX Router multicast address or Interface unicast IP address. If you have an KNX/IP interface, use the interface's IP address, for example 1982.168.1.22, otherwise, if you have a KNX/IP router, put the multicast address 224.0.23.12. You can also type an **Hostname** instead of an IP. |

<br/>

**Configuration**
|Property|Description|
|--|--|
| IP Port | The port. Default is 3671. |
| IP Protocol | *Tunnel UDP* is for KNX/IP interfaces, *Multicast UDP* is for KNX/IP Routers. Leave **Auto** for auto detect. Default is "Auto". |
| KNX Physical Address | The physical KNX address, example 1.1.200. Default is "15.15.22".|
| Bind to local interface | The Node will use this local interface for communications. Leave "Auto" for automatic selection. If you have more than one lan connection, for example Ethernet and Wifi, it's strongly recommended to manually select the interface, otherwise not all UDP telegram will reach your computer, thus the Node may not work as expected. Default is "Auto". |
| Automatically connect to KNX BUS at start | Auto connect to the bus at start. Default is "Yes". |
| Secure credentials source | Choose how KNX Secure data is provided: **ETS keyring file** (Data Secure keys and, if available, tunnelling credentials come from the keyring), **Manual credentials** (only KNX IP Tunnelling Secure with a manually entered user) or **Keyring + manual tunnel password** (Data Secure keys from the keyring while the secure tunnel uses the manual user/password). Remember: KNX Data Secure telegrams always require a keyring. |
| Tunnel interface individual address | Visible whenever the selected mode includes manual credentials (Manual or Keyring + manual tunnel password). Optional KNX individual address for the secure tunnel interface (for example `1.1.1`); leave empty to let KNX Ultimate negotiate it automatically. |
| Tunnel user ID | Visible when manual credentials are used. Optional KNX Secure tunnel user identifier defined in ETS. |
| Tunnel user password | Visible when manual credentials are used. Password of the secure tunnelling user configured in ETS. |

> **KNX Secure at a glance**  
> • *KNX Data Secure* protects group-address telegrams and **always** requires a keyring file containing the group keys.  
> • *KNX IP Tunnelling Secure* protects the connection handshake using a commissioning password. The password can come from the keyring or be entered manually depending on the selected mode.

<br/>

**Advanced**
|Property|Description|
|--|--|
| Echo sent message to all node with same Group Address | Send the msg input coming from the flow, to all nodes having the same group address. The nodes will receive the new msg as if it's coming from the KNX bus. This is useful in case of using the KNX emulation and in case the connection to the KNX bus is not established. **This option will be deprecated in the next version and defaulted to checked.** Default is checked. |
| Suppress repeated (R-Flag) telegrams fom BUS | Ignore repeated KNX telegrams coming from the bus. Default is unchecked. |
| Suppress ACK request in tunneling mode | Enable it if you have a very old KNX/IP gateway. It ignores the ACK procedure and accepts all telegrams. Default is unchecked.|
| Delay between each telegram (in milliseconds) | KNX specs states, that the maximum telegram sending speed is 50 telegrams per second. A speed between 25 and 50ms should be fine, unless you're connecting to a remote KNX Gateway via a slow internet connection (in this case, you should increase the value by, for example, 200 to 500ms or more). |
| Loglevel | Log level, in case you need to debug something with the dev. Default is "Error", |
| Node status update | Select how status badges are shown: pick **Display real time status in nodes** for the current behaviour or **Display errors only** to restrict updates to red, yellow and grey alerts. |

<br/>

**ETS file import**
|Property|Description|
|--|--|
| If Group Address has no Datapoint | If a group address doesn't have a datapoint, it allow to choose wether to stop import, import quth a fake datapoint of 1.001 or to skip import of that group address | 
| ETS group address list | Use this section to import your ETS CSV or ESF file. You can either **paste the CSV or ESF file content** or **set the file path**, for example *./pi/homecsv.csv*. Please refer to the help links for further infos. |

<br/>

**Utility**
|Property|Description|
|--|--|
| Gather debug info for troubleshoot | Please click the button and add it to the gitHub issue you want to open, it will help me a lot to helping you. |
| Get all used GA for KNX routing filter | Press READ to retrieve a plain text list of all group address belonging to this gateway, that has been used in the flows. You can use this list to populate your KNX/IP router filter table. |



<br/>

# WORKING WITH THE ETS CSV OR ESF FILE

<img src='https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/wiki/etslogo.png'>

Instead of create a knx-ultimate node for each Group Address to control, you can import your ETS csv group addresses file or, starting from V 1.1.35, an ESF file as well (If, for example,  you only have ETS Inside). Supported ETS versions: ETS 4 and onwards.<br/>

Starting from version 1.4.18, you can also simply enter the path to the file in this field (e.g.: /home/pi/mycsv.csv).<br/>

Thanks to that, the knx-ultimate node where you selected **Universal mode (listen to all Group Addresses)**, becomes an universal input/output node, aware of all Datapoints, Group Addresses and Device's name (ex: Living Room Lamp). Just send the payload to the knx-ultimate node, and it'll encode it with the right datapoint and send it to the bus. Likewise, when the knx-ultimate node receives a telegram from the bus, it outputs a right decoded payload using the datapoint specified in the ETS CSV or ESF file.

Starting from **Version 1.1.11**, you can use **Universal mode (listen to all Group Addresses)** option without the need of an imported ETS CSV or ESF File. You need to pass a message to the node, containing datapoint type and a value. As soon as the node receives a telegram from KNX Bus, it will output a RAW value and beside that, it will try to decode the value without knowing the datapoint type.<br />

**Note**: *ETS CSV Group address exported file* is way the best option, because it contain a precise datapoints with subtype. *ETS ESF exported file* is simpler and it doesn't have the subtype.<br />

If you can use both, please prefer the **ETS CSV Group address exported file**, because the ESF can lead to a false output values. Please manually check and eventually adjust the datapoints each time you import the **ESF** file.<br />From version 1.4.1 you can import group addresses also at runtime, via msg, using the WatchDog node. <br />

> You can work with a mix of knx-ultimate nodes, some with **Universal mode (listen to all Group Addresses)** checked and some not. You are absolutely free!

<a href="https://youtu.be/egRbR_KwP9I"><img src='https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/yt.png'></a>

- **ETS CSV Group Addresses List import**

  ***ATTENTION: THERE MUST NOT BE TABULATION CHARACTERS IN THE NAME OF THE GROUP ADDRESS***

**If Group Address has no Datapoint**

> If a Group address has no Datapoint set in the ETS, you can select to stop and abort the entire import process, to skip the affected group address, or to add the the affected Group Address with a fake datapoint and continue import.<br/>

**How to export the ETS -> CSV <- Group Addresses List**

> On ETS, click the group addresses list, then right click, then select 'export group addresses'. On the export window, select these options: <br />
>
> **Output Format**: CSV <br />
>
> **CSV Format**: 1/1 Name/Address <br />
>
> **Export with header line**: checked <br />
>
> **CSV Separator**: Tabulator.  <br />
>
> Then paste the file content here. <br />
>
> Note that the ETS CSV FILE must contain the Datapoints for each Group Address.  <br />
>
> The node parses your ETS CSV FILE prior to use it and will tell you the results in the DEBUG TAB of Node-Red page. <br />
>
> The result can be of two types: **ERROR** and **WARNING** <br />
>
> **ERROR** occurs when a Datapoint is not specified for a Group Address. This is a critical error and stops the process of importing the ETS CSV FILE. <br />
>
> **WARNING** occurs when a Datapoint's subtype is not specified. In this case the node parser will append a default one, but warns you that you shoult watch and correct the Datapoint, by adding a subtype. A Subtype is the number staying at the right of the "." in a Datapoint (ex: 5.001).<br />
>
> Note: the fields must be surrounded by **"** For example:<br />

>>"Attuatori luci"	"0/-/-"	""	""	""	""	"Auto"<br />

**How to export the ETS -> ESF <- Group Addresses List**

> On ETS window, select your project, then click the export icon (the icon with the up arrow)<br />
>
> Select to export the project in ESF format (not the default .knxprod)<br />
>
> Then copy the file content and paste it into the gateway config "ETS group address list" field.

<p>
    <table style="font-size:12px">
        <tr>
        <th colspan="2" style="font-size:14px">Node status colors explanation</th>
        </tr>
        <tr>
        <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greendot.png"></img></td>
        <td>React to write telegrams</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greenring.png"></img></td>
            <td>Circular reference protection. <a href="https://github.com/Supergiovane/node-red-contrib-knx-ultimate/wiki" target="_blank">See this page.</a></td>
        </tr>
        <tr>
        <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/bluedot.png"></img></td>
        <td>React to response telegrams.</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/bluering.png"></img></td>
            <td>Auto send node value as response to the BUS. <a href="https://github.com/Supergiovane/node-red-contrib-knx-ultimate/wiki/-Sample---Virtual-Device" target="_blank">See Virtual Device.</a></td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greudot.png"></img></td>
            <td>React to read telegrams.</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/greyring.png"></img></td>
            <td>RBE filter: no telegrams has been sent.</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/reddot.png"></img></td>
            <td>Error or disconnected.</td>
        </tr>
        <tr>
            <td><img src="https://raw.githubusercontent.com/Supergiovane/node-red-contrib-knx-ultimate/master/img/redring.png"></img></td>
            <td>Node DISABLED due to a circulare reference. <a href="https://github.com/Supergiovane/node-red-contrib-knx-ultimate/wiki" target="_blank">See this page.</a></td>
        </tr>
    </table>
</p>
</script>
